<!DOCTYPE html>
<html lang="en-us"><head>
  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  
  <meta name="description" content="Spark Yarn configurations">
  <meta name="author" content="Vishal Rajpal">
  <meta name="generator" content="Hugo 0.71.1" />
  
  <!-- Mobile Specific Metas -->
  <meta name="format-detection" content="telephone=no">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Spark on Yarn Configurations</title>
  <link rel="icon" href="https://vishalrajpal25.github.io/images/favicon.ico">

  <!-- Twitter Bootstrs CSS -->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionicons Fonts Css -->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/ionicons/ionicons.min.css">
  <!-- animate css -->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/animate-css/animate.css">
  <!-- Hero area slider css-->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/slider/slider.css">
  <!-- slick slider -->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/slick/slick.css">
  <!-- Fancybox -->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/facncybox/jquery.fancybox.css">
  <!-- hover -->
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/plugins/hover/hover-min.css">
  <!-- template main css file -->
  
  <link rel="stylesheet" href="https://vishalrajpal25.github.io/css/style.min.css" integrity="" media="screen">
</head><body><section class="top-bar animated-header">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<nav class="navbar navbar-expand-lg navbar-light bg-light">
					<a class="navbar-brand" href="https://vishalrajpal25.github.io/">
						<img src="https://vishalrajpal25.github.io/images/logo.png" alt="Vishal Rajpal">
					</a>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
						aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="navigation">
						<ul class="navbar-nav ml-auto">
							<li class="nav-item">
								<a class="nav-link" href="https://vishalrajpal25.github.io/">Home</a>
							</li>
							
							<li class="nav-item">
								<a class="nav-link" href="https://vishalrajpal25.github.io/about">About</a>
							</li>
							
							<li class="nav-item">
								<a class="nav-link" href="https://vishalrajpal25.github.io/tech">Data-tech</a>
							</li>
							
							<li class="nav-item">
								<a class="nav-link" href="https://vishalrajpal25.github.io/parenting">Parenting</a>
							</li>
							
							<li class="nav-item">
								<a class="nav-link" href="https://vishalrajpal25.github.io/contact">Connect</a>
							</li>
							
					</div>
				</nav>
			</div>
		</div>
	</div>
</section>

<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Spark on Yarn Configurations</h2>
                    <div class="portfolio-meta">
                        <span>Thursday, Jun 16, 2016</span>|
                        <span> Tags:
                            data, analytics, tech
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div class="post-img">
                    <img class="img-fluid" alt="" src="https://vishalrajpal25.github.io/images/data_tech/spark_configs_4.jpg">
                </div>
                
                <div class="post-content">
                    <h2 id="spark-on-yarn---considerations-and-configurations">Spark on YARN - Considerations and Configurations</h2>
<h4 id="about-spark">About Spark</h4>
<p>Apache Sparkâ„¢ is a DAG based execution engine for large-scale data processing. It has in-memory processing capabilities making it faster as compared to other execution engines. Spark boasts ease of use and generality through native language support (R, Scala, Python, Java ) and SQL &amp; streaming analytics respectively.</p>
<h4 id="spark-on-yarn">Spark on Yarn</h4>
<p>Spark runs on Hadoop (YARN), Mesos, standalone, or in the cloud. It can access diverse data sources including HDFS, Cassandra, HBase, and S3. Running Spark on YARN cluster processng of data available in HDFS as well as leveraging the hardware resources available in the already commissioned Hadoop cluster.</p>
<h4 id="spark-documentation-has-detailed-information-about-running-spark-engine-on-yarn-here">Spark documentation has detailed information about running Spark engine on YARN here</h4>
<p>As part of the article, I intend to expand on few of the important considerations and configurations to be aware about during practical usage of Spark for Machine learning or general purpose processing. I had the opportunity to play around these configurations and understand the considerations while I was involved in developing a machine learning model on text data. The versions used were: Spark 1.2, Python 2.6 and YARN.</p>
<h4 id="hadoop-environment-variables">Hadoop environment variables</h4>
<p>For Spark to run on YARN and also access the HDFS directories, it needs to know the Hadoop and Yarn client properties - basically, the resource manager (RM) address and also the HDfS port. Below are the environment variables that need to be set to the directory containing the necessary configurations:
export HADOOP_CONF_DIR=HADOOP_CONF_DIR
export YARN_CONF_DIR=YARN_CONF_DIR</p>
<h4 id="initializing-spark-on-yarn">Initializing Spark on YARN</h4>
<p>For initializing Spark on YARN, one needs to set the parameter &ndash;master to value as yarn. Within YARN, there are two modes - client and cluster. The modes have one significant difference pertaining to the control and execution of the driver program for the Spark application - whether within the client program OR AM (application master) in YARN. $ $SPARK_BIN/spark-submit &ndash;master yarn &hellip;.</p>
<h4 id="imports-and-parameters">Imports and parameters</h4>
<p>Spark is a distributed computing engine, where multiple machines are used to run executors working on different tasks. These tasks are part of a single application controlled by the driver. As the executors run tasks in parallel, it is imperative that all executors running on machines across the cluster have access to the configurations, base code, libraries and user defined modules used in the application code. Spark provides multiple parameters to share Java maven, python modules and libraries to all executors part of the launching application. These files can be passed from the client script launching the spark application. The parameters are listed below:</p>
<pre><code>--packages Comma-separated list of maven coordinates of jars
--py-files PY_FILES Comma-separated list of .zip, .egg, or .py files, one might always have some proprietary functions defined and used in the application
--files FILES Comma-separated list of files, general purpose files, dictionaries, etc.
--conf PROP=VALUE Arbitrary Spark configuration property, VM settings, etc.
--properties-file** Override spark specific properties, like memory limits
</code></pre>
<h4 id="memory-related-properties">Memory related properties</h4>
<p>Spark provides a number of properties for fine-tuning or changing default configurations. The primary ones that we need for large scale data processing are related to the memory settings of executor and drivers (listed below).
<code>driver-memory</code> ::- Total memory for driver (e.g. 1000M, 2G), container level for YARN
<code>executor-memory</code> ::- Total nemory per executor (e.g. 1000M, 2G), container level for YARN
<code>spark.yarn.executor.memoryOverhead</code> ::- Typically 6-10% of executorMemory, with minimum of 384 MB. This is the amount of off-heap memory (in megabytes) to be allocated per executor. This is memory that accounts for things like VM overheads, interned strings, other native overheads, etc. This tends to grow with the executor size (typically 6-10%).
<code>spark.yarn.driver.memoryOverhead</code> ::- Typically 6-10% of driverMemory, with minimum of 384 MB. This is the amount of off-heap memory (in megabytes) to be allocated per driver in cluster mode. This is memory that accounts for things like VM overheads, interned strings, other native overheads, etc. This tends to grow with the container size.
<code>spark.yarn.am.extraJavaOptions</code> ::- A string of extra JVM options to pass to the YARN Application Master in client mode. One can use it to pass gC level setting or debugging parameters.</p>
<h4 id="closing">Closing</h4>
<p>Spark is a powerful in-memory data processing engine with a rich API and advanced data processing capabilities like graph and machine learning. One does need to understand the right combination of Spark configurations and their tuning criteria to be able to pre-process, process and train a model on large data sets. A typical pyspark of scala spark launcher command might look like (based on the content of the article)::</p>
<pre><code>pyspark --master yarn --py-files pre_processing.py --conf spark.driver.maxResultSize=1g --num-executors 10 --driver-memory 1g --executor-memory 768m
</code></pre>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">Connect with me</h1>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">Reach out to me for pro-bono consulting, projects for social cause or general discussions.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Connect</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->


<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        <script>document.write(new Date().getFullYear())</script>
                    </span> Vishal Rajpal
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    
                    <li><a href="https://www.facebook.com/vishal.rajpal.3"><i class="ion-social-facebook"></i></a></li>
                    
                    <li><a href="https://www.linkedin.com/in/rajpalvishal/"><i class="ion-social-linkedin"></i></a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://vishalrajpal25.github.io/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://vishalrajpal25.github.io/plugins/form-validation/jquery.form.js"></script>
<script src="https://vishalrajpal25.github.io/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://vishalrajpal25.github.io/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://vishalrajpal25.github.io/plugins/bootstrap/bootstrap.min.js"></script>
<!-- wow js -->
<script src="https://vishalrajpal25.github.io/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://vishalrajpal25.github.io/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://vishalrajpal25.github.io/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://vishalrajpal25.github.io/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
</script></body>
</html>